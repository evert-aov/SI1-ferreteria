@startuml
' ============================================================================
' Diagrama de Comunicación - CU26: Dashboard Analítico Dinámico
' Sistema de Gestión de Ferretería
' Fecha: 23 de Noviembre, 2025
' ============================================================================

skinparam componentStyle rectangle

actor Administrador

component [AnalyticsView\n<<Boundary>>] as View
component [Analytics\n<<Control>>] as Controller
database [Sale\n<<Entity>>] as SaleModel
database [SaleUnperson\n<<Entity>>] as SaleUnpersonModel
database [SaleDetail\n<<Entity>>] as SaleDetailModel
database [Product\n<<Entity>>] as ProductModel
database [Entry\n<<Entity>>] as EntryModel
database [Review\n<<Entity>>] as ReviewModel
database [ProductAlert\n<<Entity>>] as AlertModel

Administrador -right-> View : 1: Acceder Dashboard
Administrador -right-> View : 2: Cambiar Filtro
Administrador -right-> View : 3: Interactuar Gráfico
View -left-> Administrador : 4: Mostrar Dashboard

View -down-> Controller : 1.1: route('/dashboard')
View -down-> Controller : 2.1: wire:model.live="dateFilter"
Controller -up-> View : 1.15: render(kpis, chartData, topProducts)
Controller -up-> View : 2.8: actualizarVista()

Controller -> Controller : 1.2: getKpisProperty()
Controller -> Controller : 1.8: getSalesChartDataProperty()
Controller -> Controller : 1.11: getTopProductsProperty()
Controller -> Controller : 1.13: getTopRatedProductsProperty()
Controller -> Controller : 1.14: getCriticalStockProductsProperty()
Controller -> Controller : 2.2: updated()

Controller -right-> SaleModel : 1.3: where('status', 'paid')->sum('total')
SaleModel -left-> Controller : 1.3.1: totalRevenueSales
Controller -right-> SaleModel : 1.4: where('status', 'paid')->count()
SaleModel -left-> Controller : 1.4.1: salesCountSales
Controller -right-> SaleModel : 1.9: DB::raw(UNION)->groupBy(period)
SaleModel -left-> Controller : 1.9.1: salesData

Controller -> SaleUnpersonModel : 1.5: where('status', 'paid')->sum('total')
SaleUnpersonModel -> Controller : 1.5.1: totalRevenueUnperson
Controller -> SaleUnpersonModel : 1.6: where('status', 'paid')->count()
SaleUnpersonModel -> Controller : 1.6.1: salesCountUnperson

Controller -down-> ProductModel : 1.7.1: where('stock', '<=', 10)->count()
ProductModel -up-> Controller : 1.7.2: criticalStockCount
Controller -down-> ProductModel : 1.12.1: find(id)->select('name', 'image')
ProductModel -up-> Controller : 1.12.2: productData

Controller -> AlertModel : 1.7: where('alert_type', 'low_stock')->count()
AlertModel -> Controller : 1.7.1: criticalStockAlerts

Controller -> EntryModel : 1.10: where('invoice_date', '>=', dateFrom)->sum('total')
EntryModel -> Controller : 1.10.1: totalExpenses

Controller -> SaleDetailModel : 1.12: DB::select(UNION sale_details)
SaleDetailModel -> Controller : 1.12.1: topProductsRaw

Controller -> ReviewModel : 1.13.1: where('status', 'approved')->groupBy('product_id')
ReviewModel -> Controller : 1.13.2: topRatedProducts

@enduml
