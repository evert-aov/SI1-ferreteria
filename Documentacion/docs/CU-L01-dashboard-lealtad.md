# CU-L01: Dashboard de Lealtad y Consulta de Historial

## Diagrama de Secuencia

![Diagrama de Secuencia](secuencia-dashboard-lealtad.puml)

## Especificación del Caso de Uso

| **Campo**                                            | **Descripción**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ---------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ID**                                               | CU-L01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Nombre**                                           | Dashboard de Lealtad y Consulta de Historial                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Actor Principal**                                  | Cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Descripción**                                      | Permite al cliente visualizar su información de lealtad completa: puntos disponibles, nivel actual, progreso, historial de transacciones y historial de canjes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Precondiciones**                                   | - El cliente debe estar autenticado<br>- El cliente debe tener rol de customer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Postcondiciones**                                  | - Se muestra el dashboard con información actualizada<br>- Se crea cuenta de lealtad si no existe<br>- El cliente puede ver su historial completo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Flujo Principal - Ver Dashboard**                  | 1. El cliente accede a "Mi Programa de Lealtad" (`/loyalty`)<br>2. El sistema verifica si tiene cuenta de lealtad<br>3. Si no existe, el sistema crea la cuenta automáticamente<br>4. El sistema carga:<br>&nbsp;&nbsp;&nbsp;- Puntos disponibles y totales ganados<br>&nbsp;&nbsp;&nbsp;- Nivel actual (ícono, nombre, color)<br>&nbsp;&nbsp;&nbsp;- Progreso al siguiente nivel (barra visual)<br>&nbsp;&nbsp;&nbsp;- Multiplicador de puntos actual<br>&nbsp;&nbsp;&nbsp;- 5 transacciones más recientes<br>&nbsp;&nbsp;&nbsp;- 5 canjes más recientes<br>5. El sistema muestra el dashboard completo                                                                                     |
| **Flujo Principal - Ver Historial de Transacciones** | 1. El cliente hace clic en "Ver todas las transacciones"<br>2. El sistema carga todas las transacciones ordenadas por fecha<br>3. El sistema muestra tabla con:<br>&nbsp;&nbsp;&nbsp;- Tipo (ganar, canjear, expirar, ajuste)<br>&nbsp;&nbsp;&nbsp;- Puntos (positivos o negativos)<br>&nbsp;&nbsp;&nbsp;- Descripción (ej: "Compra #INV-001")<br>&nbsp;&nbsp;&nbsp;- Saldo después de la transacción<br>&nbsp;&nbsp;&nbsp;- Fecha y hora<br>4. El cliente puede filtrar por tipo o fecha                                                                                                                                                                                                    |
| **Flujo Principal - Ver Historial de Canjes**        | 1. El cliente hace clic en "Ver todos los canjes"<br>2. El sistema carga todos los canjes ordenados por fecha<br>3. El sistema muestra tabla con:<br>&nbsp;&nbsp;&nbsp;- Recompensa canjeada (nombre e imagen)<br>&nbsp;&nbsp;&nbsp;- Puntos gastados<br>&nbsp;&nbsp;&nbsp;- Código de cupón (si aplica)<br>&nbsp;&nbsp;&nbsp;- Estado (pendiente, usado, expirado)<br>&nbsp;&nbsp;&nbsp;- Fecha de canje y expiración<br>4. El cliente puede copiar códigos de cupón activos                                                                                                                                                                                                                |
| **Flujos Alternativos**                              | **FA1: Primera visita (sin cuenta)**<br>- En paso 2, si no tiene cuenta<br>- El sistema crea cuenta con 0 puntos<br>- Asigna nivel inicial (primer nivel activo)<br>- Continúa con flujo normal<br><br>**FA2: Sin transacciones**<br>- Si no hay transacciones<br>- Muestra mensaje "Aún no tienes transacciones"<br>- Sugiere realizar compras<br><br>**FA3: Sin canjes**<br>- Si no hay canjes<br>- Muestra mensaje "Aún no has canjeado recompensas"<br>- Muestra botón "Ver Catálogo"                                                                                                                                                                                                    |
| **Reglas de Negocio**                                | - La cuenta se crea automáticamente en la primera visita<br>- El nivel se calcula automáticamente según puntos totales<br>- El progreso muestra puntos necesarios para el siguiente nivel<br>- Las transacciones muestran saldo después de cada operación<br>- Los canjes muestran estado actualizado del cupón<br>- Los puntos expirados se marcan claramente                                                                                                                                                                                                                                                                                                                               |
| **Requisitos Especiales**                            | - El dashboard debe cargar en menos de 2 segundos<br>- La barra de progreso debe ser visual e intuitiva<br>- Los colores del nivel deben ser consistentes<br>- El historial debe ser paginado si hay muchas transacciones                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Información Adicional**                            | **Elementos del Dashboard:**<br><br>**Tarjeta de Puntos:**<br>- Puntos disponibles (grande, destacado)<br>- Puntos totales ganados (histórico)<br>- Puntos canjeados (histórico)<br><br>**Tarjeta de Nivel:**<br>- Ícono y nombre del nivel actual<br>- Color distintivo del nivel<br>- Multiplicador de puntos (ej: 1.5x)<br>- Barra de progreso al siguiente nivel<br>- Puntos necesarios para subir<br><br>**Transacciones Recientes:**<br>- Últimas 5 transacciones<br>- Tipo con ícono (+ para ganar, - para canjear)<br>- Link "Ver todas"<br><br>**Canjes Recientes:**<br>- Últimos 5 canjes<br>- Estado con badge de color<br>- Código de cupón si está activo<br>- Link "Ver todos" |
