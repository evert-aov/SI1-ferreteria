# CU-C01: Gesti칩n de Niveles de Lealtad

## Diagrama de Secuencia

![Diagrama de Secuencia](secuencia-gestion-niveles.puml)

## Especificaci칩n del Caso de Uso

| **Campo**                      | **Descripci칩n**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ID**                         | CU-C01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Nombre**                     | Gesti칩n de Niveles de Lealtad (CRUD Completo)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Actor Principal**            | Administrador                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Descripci칩n**                | Permite al administrador gestionar completamente los niveles de membres칤a del sistema de lealtad: crear, listar, editar y eliminar niveles personalizados con sus umbrales de puntos, multiplicadores y caracter칤sticas visuales                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Precondiciones**             | - El administrador debe estar autenticado<br>- El administrador debe tener permisos de gesti칩n de lealtad                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Postcondiciones**            | - Los niveles se gestionan en la base de datos<br>- Los cambios se aplican inmediatamente en el sistema<br>- Los niveles aparecen autom치ticamente en formularios y c치lculos                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Flujo Principal - Listar**   | 1. El administrador accede a "Gestionar Niveles"<br>2. El sistema carga todos los niveles ordenados<br>3. El sistema muestra tabla con:<br>&nbsp;&nbsp;&nbsp;- Orden, 칈cono, Nombre, C칩digo<br>&nbsp;&nbsp;&nbsp;- Puntos m칤nimos, Multiplicador<br>&nbsp;&nbsp;&nbsp;- Cantidad de cuentas asociadas<br>&nbsp;&nbsp;&nbsp;- Estado (activo/inactivo)<br>&nbsp;&nbsp;&nbsp;- Acciones (Editar, Eliminar)                                                                                                                                                                                                                                                                                                                                    |
| **Flujo Principal - Crear**    | 1. El administrador hace clic en "Nuevo Nivel"<br>2. El sistema muestra formulario vac칤o<br>3. El administrador ingresa:<br>&nbsp;&nbsp;&nbsp;- **C칩digo**: Identificador 칰nico (ej: platinum)<br>&nbsp;&nbsp;&nbsp;- **Nombre**: Nombre visible (ej: Platino)<br>&nbsp;&nbsp;&nbsp;- **Puntos m칤nimos**: Umbral (ej: 15000)<br>&nbsp;&nbsp;&nbsp;- **Multiplicador**: Factor de puntos (ej: 2.0x)<br>&nbsp;&nbsp;&nbsp;- **Color**: C칩digo hex (ej: #E5E4E2)<br>&nbsp;&nbsp;&nbsp;- **칈cono**: Emoji (ej: 游눑)<br>4. El administrador marca como activo<br>5. El administrador hace clic en "Crear Nivel"<br>6. El sistema valida y asigna orden autom치tico<br>7. El sistema guarda el nivel<br>8. El sistema redirige con mensaje de 칠xito |
| **Flujo Principal - Editar**   | 1. El administrador hace clic en "Editar" de un nivel<br>2. El sistema carga los datos actuales<br>3. El sistema muestra formulario prellenado<br>4. El administrador modifica los campos deseados<br>5. El administrador hace clic en "Actualizar Nivel"<br>6. El sistema valida los cambios<br>7. El sistema actualiza el registro<br>8. El sistema redirige con mensaje de 칠xito                                                                                                                                                                                                                                                                                                                                                         |
| **Flujo Principal - Eliminar** | 1. El administrador hace clic en "Eliminar"<br>2. El sistema solicita confirmaci칩n<br>3. El administrador confirma<br>4. El sistema verifica cuentas asociadas<br>5. Si no hay cuentas, elimina el nivel<br>6. El sistema redirige con mensaje de 칠xito                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Flujos Alternativos**        | **FA1: C칩digo duplicado (Crear/Editar)**<br>- Si el c칩digo ya existe<br>- El sistema muestra error "El c칩digo ya est치 en uso"<br>- Retorna al formulario<br><br>**FA2: Validaci칩n fallida**<br>- Si puntos < 0 o multiplicador inv치lido<br>- El sistema muestra errores espec칤ficos<br>- Retorna al formulario<br><br>**FA3: Eliminar con cuentas asociadas**<br>- Si el nivel tiene cuentas de clientes<br>- El sistema muestra error "No se puede eliminar, tiene cuentas asociadas"<br>- El bot칩n eliminar est치 deshabilitado<br>- Retorna a la lista                                                                                                                                                                                    |
| **Reglas de Negocio**          | **Crear:**<br>- C칩digo 칰nico, min칰sculas, sin espacios<br>- Puntos m칤nimos >= 0<br>- Multiplicador entre 1.0 y 10.0<br>- Orden se asigna autom치ticamente (max + 1)<br><br>**Editar:**<br>- No se puede cambiar c칩digo si tiene cuentas<br>- Cambiar umbrales recalcula niveles de clientes<br>- Desactivar oculta del sistema<br><br>**Eliminar:**<br>- Solo si no tiene cuentas asociadas<br>- No se puede eliminar si es el 칰nico nivel activo                                                                                                                                                                                                                                                                                            |
| **Requisitos Especiales**      | - Color debe ser c칩digo hexadecimal v치lido (#RRGGBB)<br>- 칈cono m치ximo 10 caracteres (preferible emoji)<br>- Los cambios se aplican inmediatamente sin cach칠<br>- La tabla debe mostrar cantidad de cuentas en tiempo real                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Informaci칩n Adicional**      | **Impacto de operaciones:**<br><br>**Crear nivel:**<br>- Aparece inmediatamente en dropdowns<br>- Los clientes pueden alcanzarlo autom치ticamente<br>- Se usa en c치lculo de puntos<br><br>**Editar puntos m칤nimos:**<br>- Recalcula nivel de todas las cuentas<br>- Puede subir o bajar clientes de nivel<br><br>**Editar multiplicador:**<br>- Solo afecta compras futuras<br>- No recalcula puntos pasados<br><br>**Desactivar nivel:**<br>- No se asigna a nuevas cuentas<br>- Las cuentas existentes lo mantienen<br>- No aparece en dropdowns<br><br>**Eliminar nivel:**<br>- Permanente, no se puede recuperar<br>- Solo si no tiene cuentas asociadas                                                                                 |
